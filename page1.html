<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artale 每周 BOSS 配對 | UI 原型</title>
  <style>
    :root{
      --bg:#0b0f17; --panel:#121826; --muted:#9aa4b2; --text:#e6edf3; --brand:#7c9cff; --brand-2:#4fd1c5;
      --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --card:#0f1420; --stroke:#1f2a3a;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "PingFang TC", "Microsoft JhengHei", sans-serif;
      color:var(--text); background:linear-gradient(180deg, #0c1424, #0b0f17 35%);
    }
    .container{max-width:1200px; margin:24px auto; padding:0 16px}
    header{display:flex; align-items:center; gap:12px; margin-bottom:16px}
    .logo{width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); display:grid; place-items:center; font-weight:700}
    h1{font-size:20px; margin:0}
    .muted{color:var(--muted)}

    .layout{display:grid; grid-template-columns: 340px 1fr; gap:16px}

    /* Left: form */
    .card{background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h2{margin:0 0 8px 0; font-size:16px}
    .card .body{padding:16px}
    .section+ .section{margin-top:14px; padding-top:14px; border-top:1px dashed var(--stroke)}
    label{display:block; font-size:13px; color:var(--muted); margin:4px 0 6px}
    input[type="text"], select{width:100%; padding:10px 12px; background:var(--card); color:var(--text); border:1px solid var(--stroke); border-radius:12px; outline:none}
    input[type="text"]:focus, select:focus{border-color:var(--brand)}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:8px}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{padding:6px 10px; border-radius:999px; background:#0e1624; border:1px solid var(--stroke); cursor:pointer; user-select:none}
    .chip[data-active="true"]{border-color:var(--brand); box-shadow:0 0 0 2px rgba(124,156,255,.2) inset}

    .week{display:grid; grid-template-columns: repeat(7,1fr); gap:6px}
    .day{padding:10px 8px; text-align:center; border-radius:12px; background:var(--card); border:1px solid var(--stroke); cursor:pointer}
    .day[data-active="true"]{outline:2px solid rgba(124,156,255,.45); border-color:var(--brand)}
    .day small{display:block; color:var(--muted)}

    .actions{display:flex; gap:8px; margin-top:12px}
    button{padding:10px 14px; border-radius:12px; border:1px solid var(--stroke); background:#111827; color:var(--text); cursor:pointer}
    .btn-primary{background:linear-gradient(135deg, var(--brand), var(--brand-2)); border:none}
    .btn-ghost{background:transparent}

    /* Right: data panes */
    .tabs{display:flex; gap:6px; padding:8px; border-bottom:1px solid var(--stroke)}
    .tab{padding:8px 12px; border-radius:10px; border:1px solid transparent; cursor:pointer; color:var(--muted)}
    .tab[aria-selected="true"]{color:var(--text); background:#0d1522; border-color:var(--stroke)}

    .panel{background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius); overflow:hidden}
    .panel .body{padding:12px}

    .toolbar{display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between; margin-bottom:10px}
    .search{display:flex; gap:8px; align-items:center}
    .search input{width:260px}

    table{width:100%; border-collapse:separate; border-spacing:0 8px}
    thead th{font-size:12px; color:var(--muted); text-align:left; padding:6px 8px}
    tbody tr{background:var(--card)}
    tbody td{padding:10px 8px; border-top:1px solid var(--stroke); border-bottom:1px solid var(--stroke)}
    tbody tr td:first-child{border-left:1px solid var(--stroke); border-top-left-radius:12px; border-bottom-left-radius:12px}
    tbody tr td:last-child{border-right:1px solid var(--stroke); border-top-right-radius:12px; border-bottom-right-radius:12px}

    .badge{padding:4px 8px; border-radius:999px; border:1px solid var(--stroke); font-size:12px}
    .badge.ok{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.08)}
    .badge.warn{border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.08)}

    .empty{padding:24px; text-align:center; color:var(--muted)}

    /* Footer */
    footer{margin:18px 0 32px; color:var(--muted); font-size:12px; text-align:center}

    @media (max-width: 980px){
      .layout{grid-template-columns:1fr;}
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">A</div>
      <div>
        <h1>Artale 每周 BOSS 配對</h1>
        <div class="muted">輸入玩家資訊 ➜ 建立名單 ➜ 自動配對 7/14 場</div>
      </div>
    </header>

    <div class="layout">
      <!-- Left Column: Player form -->
      <aside class="card" aria-label="玩家設定">
        <div class="body">
          <div class="section">
            <h2>玩家資訊</h2>
            <label for="playerName">玩家名稱</label>
            <input id="playerName" type="text" placeholder="ex: 阿湯" />

            <div class="row" style="margin-top:8px">
              <div>
                <label for="job">職業</label>
                <select id="job">
                  <option value="">選擇職業…</option>
                  <option>劍士</option>
                  <option>槍手</option>
                  <option>法師</option>
                  <option>弓手</option>
                  <option>盜賊</option>
                  <option>補師</option>
                </select>
              </div>
              <div>
                <label for="rounds">本週場次</label>
                <select id="rounds">
                  <option value="7">7 場</option>
                  <option value="14" selected>14 場</option>
                </select>
              </div>
            </div>
          </div>

          <div class="section">
            <h2>可出席日  </h2>
           <!-- <button id="allDay" type="button" class="day" ><strong>全選</strong><small>WoYaoQunBu</small></button>-->
            
            <div class="week" id="week">
              <button type="button" class="day" data-day="1"><strong>一</strong><small>Mon</small></button>
              <button type="button" class="day" data-day="2"><strong>二</strong><small>Tue</small></button>
              <button type="button" class="day" data-day="3"><strong>三</strong><small>Wed</small></button>
              <button type="button" class="day" data-day="4"><strong>四</strong><small>Thu</small></button>
              <button type="button" class="day" data-day="5"><strong>五</strong><small>Fri</small></button>
              <button type="button" class="day" data-day="6"><strong>六</strong><small>Sat</small></button>
              <button type="button" class="day" data-day="0"><strong>日</strong><small>Sun</small></button>
            </div>
            <div class="chips" style="margin-top:10px">
              <span class="muted" style="font-size:12px">時段偏好：</span>
              <div class="chip" data-chip="am">上午</div>
              <div class="chip" data-chip="pm">下午</div>
              <div class="chip" data-chip="eve">晚上</div>
              <div class="chip" data-chip="late">深夜</div>
            </div>
          </div>

          <div class="section" style="display: none;">
            <h2>隊伍偏好</h2>
            <div class="chips">
              <div class="chip" data-chip="role-dps">DPS</div>
              <div class="chip" data-chip="role-tank">坦克</div>
              <div class="chip" data-chip="role-heal">補師</div>
              <div class="chip" data-chip="same-class">同職業加成</div>
              <div class="chip" data-chip="newbie-ok">可帶新手</div>
            </div>
          </div>

          <div class="actions">
            <button class="btn-primary" id="btnAdd">加入名單</button>
            <button class="btn-ghost" id="btnReset" title="清除表單">重填</button>
          </div>
        </div>
      </aside>

      <!-- Right Column: Data / Results -->
      <main class="panel" aria-label="資料與結果">
        <nav class="tabs" role="tablist">
          <button class="tab" role="tab" aria-selected="true" data-tab="players">玩家名單</button>
          <button class="tab" role="tab" aria-selected="false" data-tab="matches">配對建議</button>
          <button class="tab" role="tab" aria-selected="false" data-tab="schedule">本週排程</button>
        </nav>
        <section class="body">
          <!-- Toolbar -->
          <div class="toolbar">
            <div class="search">
              <input id="search" type="text" placeholder="搜尋玩家/職業…" />
              <button id="btnExport">匯出 JSON</button>
              <input id="importFile" type="file" accept="application/json" hidden />
              <button id="btnImport">匯入 JSON</button>
            </div>
            <div>
              <button class="btn-primary" id="btnAuto">自動配對</button>
            </div>
          </div>

          <!-- Tab: Players -->
          <div id="pane-players">
            <table aria-label="玩家名單">
              <thead>
                <tr>
                  <th>玩家</th>
                  <th>職業</th>
                  <th>場次</th>
                  <th>可出席</th>
                  <th>偏好</th>
                  <th style="width:80px">操作</th>
                </tr>
              </thead>
              <tbody id="playerRows">
                <tr class="empty"><td colspan="6" class="empty">目前沒有玩家，請從左側新增</td></tr>
              </tbody>
            </table>
          </div>

          <!-- Tab: Matches -->
          <div id="pane-matches" hidden>
            <div class="empty">尚未產生配對結果。點擊右上角的「自動配對」。</div>
            <div id="matchList"></div>
          </div>

          <!-- Tab: Schedule -->
          <div id="pane-schedule" hidden>
            <table aria-label="本週排程">
              <thead>
                <tr>
                  <th>日期</th>
                  <th>BOSS</th>
                  <th>隊伍</th>
                  <th>狀態</th>
                </tr>
              </thead>
              <tbody id="scheduleRows">
                <tr class="empty"><td colspan="4">尚未建立排程。</td></tr>
              </tbody>
            </table>
          </div>
        </section>
      </main>
    </div>

    <footer>
      <span class="muted">UI 原型 v0.1 · 純前端 / 可直接部署到 GitHub Pages · 之後可接演算法</span>
    </footer>
  </div>
  <script>
  $(function(){

    // Toggle chips & days
    $(".chip").on("click", function(){
      const active = $(this).attr("data-active") === "true";
      $(this).attr("data-active", !active);
    });

    $(".day").on("click", function(){
      const active = $(this).attr("data-active") === "true";
      $(this).attr("data-active", !active);
    });

    // Tabs
    const panes = {
      players: $("#pane-players"),
      matches: $("#pane-matches"),
      schedule: $("#pane-schedule")
    };
    $(".tab").on("click", function(){
      $(".tab").attr("aria-selected","false");
      $(this).attr("aria-selected","true");
      const key = $(this).data("tab");
      $.each(panes, function(k,v){ v.prop("hidden", k!==key); });
    });

    // Storage
    const STORAGE_KEY = "artale-boss-players";
    const loadPlayers = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    const savePlayers = (list) => localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

    // Render players
    function renderPlayers(){
      const $tbody = $("#playerRows");
      const list = loadPlayers();
      $tbody.empty();

      if(list.length===0){
        $tbody.append(`<tr class="empty"><td colspan="6" class="empty">目前沒有玩家，請從左側新增</td></tr>`);
        return;
      }

      const keyword = $("#search").val().trim().toLowerCase();
      $.each(list, function(idx, p){
        if(!keyword || (`${p.name} ${p.job}`).toLowerCase().includes(keyword)){
          const days = (p.days||[]).map(d=>["日","一","二","三","四","五","六"][d]).join("、") || "-";
          const prefs = (p.prefs||[]).join("、") || "-";
          $tbody.append(`
            <tr>
              <td>${p.name}</td>
              <td><span class="badge">${p.job||"-"}</span></td>
              <td>${p.rounds||"-"}</td>
              <td>${days}</td>
              <td>${prefs}</td>
              <td>
                <button data-act="edit" data-idx="${idx}">編輯</button>
                <button data-act="del" data-idx="${idx}">刪除</button>
              </td>
            </tr>
          `);
        }
      });
    }
    renderPlayers();

    // Add player
    $("#btnAdd").on("click", function(e){
      e.preventDefault();
      const name = $("#playerName").val().trim();
      const job = $("#job").val();
      const rounds = $("#rounds").val();
      if(!name){ alert("請輸入玩家名稱"); return; }

      const days = $(".day[data-active='true']").map(function(){ return +$(this).data("day"); }).get();
      const prefs = $(".chip[data-active='true']").map(function(){ return $(this).text().trim(); }).get();

      const list = loadPlayers();
      list.push({ id: crypto.randomUUID(), name, job, rounds, days, prefs, createdAt: Date.now() });
      savePlayers(list);

      // reset form
      $("#playerName").val("");
      $("#job").val("");
      $("#rounds").val("14");
      $(".day, .chip").removeAttr("data-active");

      renderPlayers();
    });

    $("#btnReset").on("click", function(){
      $("#playerName").val("");
      $("#job").val("");
      $("#rounds").val("14");
      $(".day, .chip").removeAttr("data-active");
    });

    // Delete / Edit
    $("#playerRows").on("click", "button", function(){
      const idx = +$(this).data("idx");
      const act = $(this).data("act");
      const list = loadPlayers();

      if(act==="del"){
        if(confirm("確定刪除這位玩家？")){
          list.splice(idx,1);
          savePlayers(list);
          renderPlayers();
        }
      }
      if(act==="edit"){
        const p = list[idx];
        $("#playerName").val(p.name);
        $("#job").val(p.job);
        $("#rounds").val(p.rounds);

        $(".day").each(function(){
          $(this).attr("data-active", p.days.includes(+$(this).data("day")));
        });
        $(".chip").each(function(){
          $(this).attr("data-active", p.prefs.includes($(this).text().trim()));
        });

        list.splice(idx,1);
        savePlayers(list);
        renderPlayers();
      }
    });

    // Search
    $("#search").on("input", renderPlayers);

    // Export
    $("#btnExport").on("click", function(){
      const blob = new Blob([localStorage.getItem(STORAGE_KEY) || "[]"], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "artale-players.json";
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // Import
    $("#btnImport").on("click", function(){ $("#importFile").click(); });
    $("#importFile").on("change", function(e){
      const file = e.target.files?.[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(){
        try{
          const data = JSON.parse(reader.result || "[]");
          if(!Array.isArray(data)) throw new Error("格式錯誤");
          savePlayers(data); renderPlayers();
        }catch(err){ alert("匯入失敗："+err.message); }
      };
      reader.readAsText(file, "utf-8");
      e.target.value="";
    });

    // Auto match (stub)
    $("#btnAuto").on("click", function(){
      const list = loadPlayers();
      const result = mockMatch(list);
      $("#pane-matches").html(result.html || "<div class='empty'>沒有可配對的資料</div>");

      // 切到配對頁
      $(".tab").attr("aria-selected", function(){ return String($(this).data("tab")==="matches"); });
      $.each(panes, function(k,v){ v.prop("hidden", k!=="matches"); });
    });

    function mockMatch(players){
      if(players.length<6){
        return { html: "<div class='empty'>玩家不足，至少需要 6 人以上</div>" };
      }
      const byDay = new Map();
      players.forEach(p=>{
        (p.days?.length? p.days : [-1]).forEach(d=>{
          if(!byDay.has(d)) byDay.set(d, []);
          byDay.get(d).push(p);
        });
      });
      let html = "";
      for(const [day, list] of byDay){
        const title = day===-1? "未填可出席" : `星期${["日","一","二","三","四","五","六"][day]}`;
        html += `<div style="margin:10px 0; padding:12px; border:1px solid var(--stroke); border-radius:12px; background:var(--card)">`;
        html += `<div style="margin-bottom:8px"><strong>${title}</strong> · 候選 ${list.length} 人</div>`;
        const chunks = list.reduce((arr, p, i)=>{
          if(i%6===0) arr.push([]);
          arr[arr.length-1].push(p);
          return arr;
        }, []);
        chunks.forEach((team, idx)=>{
          html += `<div style="margin:8px 0; padding:8px; border:1px dashed var(--stroke); border-radius:10px">`;
          html += `<div style="margin-bottom:6px">隊伍 ${idx+1} · <span class="badge ${team.length===6?'ok':'warn'}">${team.length}/6</span></div>`;
          html += `<div>${team.map(p=>`${p.name} <span class='badge'>${p.job||''}</span>`).join("、 ")||"—"}</div>`;
          html += `</div>`;
        });
        html += `</div>`;
      }
      return { html };
    }

  });
</script>


</body>
</html>
